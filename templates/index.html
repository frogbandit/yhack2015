<!DOCTYPE html>
  <html>
    <head>
      <!--Import Google Icon Font-->
      <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
      <!-- Compiled and minified CSS -->
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.1/css/materialize.min.css">

      <!--Let browser know website is optimized for mobile-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
      <title>Centr</title>
      <meta name="viewport" content="initial-scale=1.0">
      <meta charset="utf-8">
      <style>
        html, body {
          height: 500px;
          width: 1000px;
          margin: 0;
          padding: 0;
        }
        #map {
          height: 100%;
        }
      </style>
    </head>

    <body>
      <div id="map"></div>

    <div class="locationField">
      <div id = "inputlar">
      <input id = "pac-input" class="controlsInput" placeholder="Enter your address"
             onFocus="geolocate()" type="text"></input>
      <input id = "pac-input2" class="controlsInput" placeholder="Enter your address"
             onFocus="geolocate()" type="text"></input>
      </div><br/>
      <input id="addInputField" type="button" value="Add new location" class="styled-button-10"/>
      <div class="row">
        <p>
          <input type="checkbox" id="cafe" checked="checked">
          <label for="cafe">Cafe</label>
        </p>
        <p>
          <input type="checkbox" id="restaurant">
          <label for="restaurant">Restaurant</label>
        </p>
        <p>
          <input type="checkbox" id="park">
          <label for="park">Park</label>
        </p>
      </div>
      <button class="btn btn-lg btn-success" onclick="calculate()">Submit</button> 
    </div>

    <table id="results">
      <thead>
        <tr>
            <th data-field="name">Name</th>
            <th data-field="address">Address</th>
            <th data-field="rating">Rating</th>
            <th data-field="price_level">Price Level</th>
        </tr>
      </thead>
      <tbody>

      </tbody>
    </table>

    <script>
// This example displays an address form, using the autocomplete feature
// of the Google Places API to help users fill in the information.

var autocomplete = [];
var map;
var infowindow;
var locations = [];
var main_markers = [];
var markers = [];
var inputs = [];

function initAutocomplete() {
  map = new google.maps.Map(document.getElementById('map'), {
      center: {lat: 41.3100, lng: -72.9236},
      zoom: 14
    });

  inputs = document.getElementsByClassName("controlsInput");
  for(var i = 0; i < inputs.length; i++) {  
   setupAutocomplete(autocomplete,inputs,i);
  }

  $(document).ready(function(){
    var count = 2;
    $("#addInputField").click(function(){
        count++;
        $("#inputlar").append("<input id='pac-input" + count + "' class='controlsInput' type='text' placeholder='Enter your address' /> <br />");

        // added
        var newInput = [];
        var newEl = document.getElementById('pac-input' + count);
        newInput.push(newEl);
        setupAutocomplete(autocomplete, newInput, 0);

        if (count === 7) {
            $("#addInputField").remove();
        }
    });    
});
}

function setupAutocomplete(autocomplete, inputs, i){
  // autocomplete[i] = new google.maps.places.Autocomplete(inputs[i])
  autocomplete.push(new google.maps.places.Autocomplete(inputs[i]));
  var idx = autocomplete.length - 1;
  autocomplete[idx].bindTo('bounds', map);
  google.maps.event.addListener(autocomplete[idx], 'place_changed', function() {
  // google.maps.event.addListener(autocomplete[i], 'place_changed', function() {
    var place = autocomplete[idx].getPlace();
    var lat = place.geometry.location.lat();
    var lng = place.geometry.location.lng();
    var myLatLng = {lat: lat, lng: lng};
    main_markers[idx] = new google.maps.Marker({
      position: myLatLng,
      map: map,
      title: 'Hello World!'
    });
    console.log(lat,lng);
    main_markers[idx].setMap(map);
  });
}

function calculate(){
  $('#results tbody > tr').remove();
  removeMarkers();
  for(var i = 0; i < autocomplete.length; i++) { 
   locations.push(autocomplete[i].getPlace());
  }
  var center = obtainCenter(locations);
  center_lat = center.lat();
  center_lng = center.lng();
  var params = [];
  if ($('#cafe').is(':checked'))
    params.push('cafe');
  if ($('#restaurant').is(':checked'))
    params.push('restaurant');
  if ($('#park').is(':checked'))
    params.push('park');
  console.log(params);
  getLocations(params);
}

function getLocations(type){
  infowindow = new google.maps.InfoWindow();

  var request = {
    location: {lat: center_lat, lng: center_lng},
    radius: '500', 
    types: type
  };

  service = new google.maps.places.PlacesService(map);
  service.nearbySearch(request, callback);

  function callback(results, status) {
    if (status == google.maps.places.PlacesServiceStatus.OK) {
      for (var i = 0; i < results.length; i++) {
        var place = results[i];
        createMarker(results[i]);
        name = results[i].name;
        address = results[i].vicinity;
        rating = 'N/A';
        if (results[i].rating != undefined)
          rating = results[i].rating;
        price_level = 'N/A';
        if (results[i].price_level != undefined)
          price_level = results[i].price_level;
        $("#results tbody").append('<tr><td>'+name+'</td><td>'+address+'</td><td>'+rating+'</td><td>'+price_level+'</td></tr><br>');
      }
      console.log(results);
    }
  }

  function createMarker(place) {
    var placeLoc = place.geometry.location;
    var marker = new google.maps.Marker({
      map: map,
      position: place.geometry.location,
      icon: 'http://maps.google.com/mapfiles/ms/icons/blue-dot.png'
    });

    markers.push(marker);
    google.maps.event.addListener(marker, 'click', function() {
      infowindow.setContent(place.name);
      infowindow.open(map, this);
    });
  }
}

function removeMarkers(){
    for(i=0; i<markers.length; i++){
        markers[i].setMap(null);
    }
}

function obtainCenter(locations) {
  var bound = new google.maps.LatLngBounds();

  for (i = 0; i < locations.length; i++) {
    bound.extend( new google.maps.LatLng(locations[i].geometry.location.lat(), locations[i].geometry.location.lng()));
  }
  return bound.getCenter();
}

// [START region_geolocation]
// Bias the autocomplete object to the user's geographical location,
// as supplied by the browser's 'navigator.geolocation' object.
function geolocate() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(function(position) {
      var geolocation = {
        lat: position.coords.latitude,
        lng: position.coords.longitude
      };
      var circle = new google.maps.Circle({
        center: geolocation,
        radius: position.coords.accuracy
      });
      // autocomplete.setBounds(circle.getBounds());
    });
  }
}
// [END region_geolocation]

    </script>
      <script>
   

      </script>
      <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAbebnQH25_Kuyk2dihcatibtfsSS7IVDI&signed_in=true&libraries=places&callback=initAutocomplete"
          async defer></script>

      <!--Import jQuery before materialize.js-->
      <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
      <!-- Compiled and minified JavaScript -->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.1/js/materialize.min.js"></script>
    </body>
  </html>
